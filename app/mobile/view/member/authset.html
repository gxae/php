<div class="a-header position-re">
	<a href="javascript:window.history.go(-1);"><i class="layui-icon layui-icon-left"></i></a>
	<div class="layui-inline h-span">{:lang('public_memu.member_authset')}</div>
</div>
<div class="new-bg">
	<!--主体-->
	<div class="main-no padding-l-r mt-10">
		{if $auth && $auth=='wno'}
		<div class="layui-bg-orange text-center line-36">{:lang('public_memu.member_authset_wno')}</div>
		{/if}
		<div class="a-form">
			<div class="auth-box">
				<div class="auth-box-item">
					<div class="auth-box-line-a color-blue">
						{:lang('authset.step_1')}
					</div>
				</div>
				<div class="auth-box-item">
					<div class="auth-box-line"></div>
				</div>
				<div class="auth-box-item">
					<div class="auth-box-line-b">
						<i class="fa fa-circle" aria-hidden="true"></i>
					</div>
					<div class="auth-box-line-b color-blue">
						{:lang('authset.step_2')}
					</div>
				</div>
				<div class="auth-box-item">
					<div class="auth-box-line"></div>
				</div>
				<div class="auth-box-item">
					<div class="auth-box-line-b">
						<i class="fa fa-circle" aria-hidden="true"></i>
					</div>
					<div class="auth-box-line-b color-blue">
						{if $card.status !== 1}
						{:lang('authset.step_3')}
						{else}
						{:lang('authset.step_4')}
						{/if}
					</div>
				</div>
			</div>
			{if $card.status == 0}
			<form class="layui-form" action="">
				{if $card.card_a && $card.card_b && $card.card_c}
				<div class="layui-form-item text-center">
					<p class="color-blue">{:lang('authset.card_status_0')}</p>
				</div>
				<div class="layui-form-item full-btn" style="padding-top: 30px;">
					<a href="javascript:window.history.go(-1);" class="layui-btn layui-btn-normal layui-btn-fluid layui-btn-lg">{:lang('public.goback')}</a>
				</div>
				{else}
				<div class="layui-form-item">
					<label class="a-label">{:lang('authset.name')}：</label>
					<div class="">
					<input type="text" name="name" lay-verify="required" lay-verType="tips" lay-reqText="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.name'))}" placeholder="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.name'))}" autocomplete="off" class="layui-input" value="{$card.name|default=''}">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="a-label">{:lang('authset.card')}：</label>
					<div class="">
					<input type="text" name="card" lay-verify="required" lay-verType="tips" lay-reqText="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.card'))}" placeholder="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.card'))}" autocomplete="off" class="layui-input" value="{$card.card|default=''}">
					</div>
				</div>
				<div class="layui-form-item">
					<p>{:lang('authset.content')}</p>
				</div>
				<div class="layui-form-item">
					<div class="a-flex text-center sfz-box">
						<div class="a-flex-item" id="card_a_btn">
							{if $card.card_a}<img src="{$card.card_a}" width="100%" height="100%">{else}<img src="__STATIC__/index/img/sf_zm.png" >{/if}
							<input type="hidden" id="card_a" name="card_a" value="">
						</div>
						<div class="a-flex-item" id="card_b_btn">
							{if $card.card_b}<img src="{$card.card_b}" width="100%" height="100%">{else}<img src="__STATIC__/index/img/sf_fm.png" >{/if}
							<input type="hidden" id="card_b" name="card_b" value="">
						</div>
						<!--<div class="a-flex-item" id="card_c_btn">-->
							<!--{if $card.card_c}<img src="{$card.card_c}" width="100%" height="100%">{else}<img src="__STATIC__/index/img/sf_sc.png" >{/if}-->
							<!--<input type="hidden" id="card_c" name="card_c" value="">-->
						<!--</div>-->
					</div>
				</div>
				<div class="layui-form-item full-btn" style="padding-top: 30px;">
					<button class="layui-btn layui-btn-normal layui-btn-fluid layui-btn-lg" lay-submit lay-filter="setCard">{:lang('authset.form_btn')}</button>
				</div>
				{/if}
			</form>
			{elseif $card.status == 2}
			<form class="layui-form" action="">
				<div class="layui-form-item text-center">
					{if $card.card_a && $card.card_b && $card.card_c}
					<p class="color-blue">{:lang('authset.card_status_2')}</p>
					{/if}
					{if $card.status == 2 && $card.remark}
					<p class="color-red">{$card.remark|raw|nl2br|htmlspecialchars_decode|html_entity_decode}</p>
					{/if}
				</div>
				<div class="layui-form-item">
					<label class="a-label">{:lang('authset.name')}：</label>
					<div class="">
					<input type="text" name="name" lay-verify="required" lay-verType="tips" lay-reqText="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.name'))}" placeholder="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.name'))}" autocomplete="off" class="layui-input" value="{$card.name|default=''}">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="a-label">{:lang('authset.card')}：</label>
					<div class="">
					<input type="text" name="card" lay-verify="required" lay-verType="tips" lay-reqText="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.card'))}" placeholder="{:fox_all_replace(lang('wicket_page.please_input'),lang('authset.card'))}" autocomplete="off" class="layui-input" value="{$card.card|default=''}">
					</div>
				</div>
				<div class="layui-form-item">
					<p>{:lang('authset.content')}</p>
				</div>
				<div class="layui-form-item">
					<div class="a-flex text-center sfz-box">
						<div class="a-flex-item" id="card_a_btn">
							{if $card.card_a}<img src="{$card.card_a}" width="100%" height="100%">{else}<img src="__STATIC__/index/img/sf_zm.png" >{/if}
							<input type="hidden" id="card_a" name="card_a" value="">
						</div>
						<div class="a-flex-item" id="card_b_btn">
							{if $card.card_b}<img src="{$card.card_b}" width="100%" height="100%">{else}<img src="__STATIC__/index/img/sf_fm.png" >{/if}
							<input type="hidden" id="card_b" name="card_b" value="">
						</div>
						<div class="a-flex-item" id="card_c_btn">
							{if $card.card_c}<img src="{$card.card_c}" width="100%" height="100%">{else}<img src="__STATIC__/index/img/sf_sc.png" >{/if}
							<input type="hidden" id="card_c" name="card_c" value="">
						</div>
					</div>
				</div>
				<div class="layui-form-item full-btn" style="padding-top: 30px;">
						<button class="layui-btn layui-btn-normal layui-btn-fluid layui-btn-lg" lay-submit lay-filter="setCard">{:lang('authset.form_btn_re')}</button>
				</div>
			</form>
			{elseif $card.status == 1}
			<div class="layui-form">
				<div class="layui-form-item text-center">
					<p class="color">{:lang('authset.card_status_1')}</p>
				</div>
			</div>
			<div class="layui-form-item full-btn" style="padding-top: 30px;">
				<a href="javascript:window.history.go(-1);" class="layui-btn layui-btn-normal layui-btn-fluid layui-btn-lg">{:lang('public.goback')}</a>
			</div>
			{/if}
		</div>
	</div>
</div>
<!--footer-->
{include file="./block/foot_script"}

<script>
	layui.use(['layer', 'jquery', 'form', 'upload'], function(){
		var layer = layui.layer
		,$ = layui.jquery
		,form = layui.form;
		var upload = layui.upload;

		$.ajaxSetup({
			headers: {
				'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
			}
		});

		upload.render({
			elem: '#card_a_btn'
			,url: "{:url('member/upload_card')}"
			,exts: 'jpg|png|jpeg',
			before: function(obj){
				obj.preview(function(index, file, result){
					$('#card_a_btn').find('img').attr('src',result);
					$('#card_a_btn').find('img').css({'width':'100%','height':'100%'});
				});
			},
			done: function(res){
				if(res.code !== 0){
                    return layer.msg(res.msg);
                }
                //上传成功
                if(res.data.url){
                    $('#card_a').val(res.data.src);
                    layer.msg(res.msg);
                }
			}
		});

		upload.render({
			elem: '#card_b_btn'
			,url: "{:url('member/upload_card')}"
			,exts: 'jpg|png|jpeg',
			before: function(obj){
				obj.preview(function(index, file, result){
					$('#card_b_btn').find('img').attr('src',result);
					$('#card_b_btn').find('img').css({'width':'100%','height':'100%'});
				});
			},
			done: function(res){
				if(res.code !== 0){
                    return layer.msg(res.msg);
                }
                //上传成功
                if(res.data.url){
                    $('#card_b').val(res.data.src);
                    layer.msg(res.msg);
                }
			}
		});

		upload.render({
			elem: '#card_c_btn'
			,url: "{:url('member/upload_card')}"
			,exts: 'jpg|png|jpeg',
			before: function(obj){
				obj.preview(function(index, file, result){
					$('#card_c_btn').find('img').attr('src',result);
					$('#card_c_btn').find('img').css({'width':'100%','height':'100%'});
				});
			},
			done: function(res){
				if(res.code !== 0){
                    return layer.msg(res.msg);
                }
                //上传成功
                if(res.data.url){
                    $('#card_c').val(res.data.src);
                    layer.msg(res.msg);
                }
			}
		});

		form.on('submit(setCard)', function(data){
			if(!data.field.card_a){
				$('#card_a_btn').find('img').css({'border':'1px solid #ff6600'});
				layer.msg("{:lang('authset.please_upload')}", {time: 1000});
				return false;
			}else{
				$('#card_a_btn').find('img').css({'border':'1px solid #e2e2e2'});
			}
			if(!data.field.card_b){
				$('#card_b_btn').find('img').css({'border':'1px solid #ff6600'});
				layer.msg("{:lang('authset.please_upload')}", {time: 1000});
				return false;
			}else{
				$('#card_a_btn').find('img').css({'border':'1px solid #e2e2e2'});
			}
			// if(!data.field.card_c){
			// 	$('#card_c_btn').find('img').css({'border':'1px solid #ff6600'});
			// 	layer.msg("{:lang('authset.please_upload')}", {time: 1000});
			// 	return false;
			// }else{
			// 	$('#card_a_btn').find('img').css({'border':'1px solid #e2e2e2'});
			// }
			if(data.field.name && data.field.card){
				loading =layer.load(1, {shade: [0.1,'#fff']});
				$.post("", data.field, function (res) {
					layer.close(loading);
					if (res.code > 0) {
						layer.msg(res.msg, {time: 1800}, function () {
							location.href = res.url;
						});
					} else {
						if(res.url){
							layer.msg(res.msg, {time: 1800}, function () {
								location.href = res.url;
							});
						}else{
							layer.msg(res.msg, {time: 1800});
						}
					}
				});
			}
			return false;
		})
		$(".showthis").click(function(){
			var img = $(this).find('img').attr('src');
			var div = '<div><img src="'+img+'" width="100%" height="100%"></div>';
			var index = layer.open({
				type: 1,
				title: false,
				area: ['90%', '90%'],
				skin: 'layui-layer-rim',
				content: div,
			});
			// layer.full(index);
		})
	})
</script>